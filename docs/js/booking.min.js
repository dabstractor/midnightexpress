!function(e){"use strict";const t="https://docs.google.com/forms/d/e/1FAIpQLSelLJ8Yqj8jHXreIB3DW8MvsBUtHea8DB7UTjyaYkM3Q2RbTA/formResponse";let i=[],n=null;async function o(){return n&&Date.now()-n<6e4?Promise.resolve(i):new Promise(function(t,o){e.ajax({url:"https://script.google.com/macros/s/AKfycbzlJKEyRE9jriEa27errgYXQQA4mcVA0bZU1nxoILvCcBpXaW2FkCPwKZp1yewvDvKo/exec",method:"GET",dataType:"json",cache:!1,success:function(e){console.log("Fetched bookings:",e),i=e,n=Date.now(),t(e)},error:function(e,n,o){console.error("Error fetching bookings:",n,o),console.warn("Using cached or empty booking data"),t(i.length>0?i:[])}})})}async function r(e){const t=await o();return console.log("allBookings: ",t),t.filter(function(t){return t.date===e}).map(function(e){const t=function(e){const t=new Date(e);return{hours:t.getUTCHours(),minutes:t.getUTCMinutes()}}(e.time);return{date:e.date,hours:t.hours,minutes:t.minutes}})}function s(e,t){const i=60*e+t;return{startMinutes:i-120,endMinutes:i+105}}function a(e){const t=e.map(function(e){var t=s(e.hours,e.minutes);return{start:Math.max(0,t.startMinutes),end:Math.min(1440,t.endMinutes),bookingTime:60*e.hours+e.minutes}});t.sort(function(e,t){return e.start-t.start});const i=[];for(let e=0;e<t.length;e++){const n=t[e];0===i.length||n.start>i[i.length-1].end?i.push({start:n.start,end:n.end}):i[i.length-1].end=Math.max(i[i.length-1].end,n.end)}let n='<div style="position: relative; margin: 20px 0;">';return n+='<div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 11px; color: #666;">',n+="<span>12:00 AM</span>",n+="<span>12:00 PM</span>",n+="<span>11:59 PM</span>",n+="</div>",n+='<div style="position: relative; height: 40px; background: #27AE60; border-radius: 4px; overflow: visible;">',i.forEach(function(e){var t=e.start/1440*100,i=(e.end-e.start)/1440*100,o=Math.floor(e.start/60),r=e.start%60,s=Math.floor(e.end/60),a=e.end%60;n+='<div style="position: absolute; left: '+t+"%; width: "+i+'%; height: 100%; background: #d9534f; border-radius: 2px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: bold; line-height: 1.2;">',n+="<span>"+((o%12||12)+":"+(r<10?"0":"")+r+" "+(o>=12?"PM":"AM"))+"</span>",n+='<span style="line-height: 0.2;">-</span>',n+="<span>"+((s%12||12)+":"+(a<10?"0":"")+a+" "+(s>=12?"PM":"AM"))+"</span>",n+="</div>"}),n+="</div>",n+="</div>",n+='<div style="display: flex; gap: 20px; margin-top: 10px; font-size: 12px; justify-content: center;">',n+='<div><span style="display: inline-block; width: 15px; height: 15px; background: #27AE60; border-radius: 2px; vertical-align: middle; margin-right: 5px;"></span>Available</div>',n+='<div><span style="display: inline-block; width: 15px; height: 15px; background: #d9534f; border-radius: 2px; vertical-align: middle; margin-right: 5px;"></span>Unavailable</div>',n+="</div>",n}function l(e){return new Date(e+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}async function c(t,i){if(!t)return e("#timeline-container").slideUp(),void(i&&i([]));e("#timeline-date").text(l(t)),e("#timeline-visual").html('<p style="text-align: center; color: #666;">Loading bookings...</p>'),e("#timeline-container").slideDown();const n=await r(t);0===n.length?(e("#timeline-instruction").hide(),e("#timeline-visual").html('<p style="text-align: center; color: #27AE60; font-weight: bold;">All times available!</p>')):(e("#timeline-instruction").show(),e("#timeline-visual").html(a(n))),i&&i(n)}function p(e){return 10===e.replace(/\D/g,"").length}function u(e){return/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)}function d(e,t,i){if(!e||!t)return{valid:!1,error:"Please select both date and time"};const n=new Date(e+"T"+t),o=new Date;if(n<o)return{valid:!1,error:"Pickup time cannot be in the past"};return n<new Date(o.getTime()+108e5)?{valid:!1,error:"Please book at least 3 hours in advance. For urgent bookings, call (980) 422-9125"}:function(e,t,i){const[n,o]=t.split(":").map(Number),r=60*n+o;return i.some(function(e){const t=s(e.hours,e.minutes);return r>=t.startMinutes&&r<=t.endMinutes})}(0,t,i)?{valid:!1,error:"This time slot is not available (conflicts with existing booking). Please choose a different time."}:{valid:!0,error:""}}function g(){const t=e('input[name="airport-trip"]:checked').val(),i=e("#booking-round-trip").is(":checked");"Yes"===t?(e("#flight-info-section").slideDown(),e("#checking-bags-section").slideDown(),e("#round-trip-section").slideDown()):(e("#flight-info-section").slideUp(),e("#checking-bags-section").slideUp(),e("#round-trip-section").slideUp(),e("#booking-flight").val(""),e("#booking-checking-bags").prop("checked",!1),e("#booking-round-trip").prop("checked",!1)),"Yes"===t&&i?(e("#return-flight-section").slideDown(),e("#return-timeline-container").slideDown()):(e("#return-flight-section").slideUp(),e("#return-timeline-container").slideUp(),e("#booking-return-datetime").val(""),e("#return-datetime-error").text("").hide())}function h(t,i){if(!t||!i)return!0;const n=new Date(t);return new Date(i)<=n?(e("#return-datetime-error").text("Return date must be after pickup date").show(),e("#booking-return-datetime").closest(".form-group").addClass("has-error"),!1):(e("#return-datetime-error").text("").hide(),e("#booking-return-datetime").closest(".form-group").removeClass("has-error"),!0)}function m(e){let t=6;return(e.wheelchair||e.carseat)&&(t-=1),e.checkingBags&&(t-=1),Math.max(t,1)}function k(){const t=e("#booking-wheelchair").is(":checked"),i=e("#booking-carseat").is(":checked"),n=e("#booking-checking-bags").is(":checked"),o=m({wheelchair:t,carseat:i,checkingBags:n});let r=e("#passenger-capacity-message");if(0===r.length&&(e("#booking-passengers").closest(".form-group").append('<small id="passenger-capacity-message" class="help-block" style="color: #666; font-size: 12px; margin-top: 5px;"></small>'),r=e("#passenger-capacity-message")),t||i||n){let e=[];(t||i)&&e.push("mobility aid"),n&&e.push("checked bags");const s=e.join(", ");r.text("Maximum passengers: "+o+" (reduced for "+s+")").show()}else r.text("");e("#booking-passengers").attr("max",o);(parseInt(e("#booking-passengers").val())||1)>o?(e("#booking-passengers").val(o),r.css("color","#d9534f")):r.css("color","#666")}async function b(i){const n=[],o={name:i.name,phone:i.phone,email:i.email,pickupDate:i.pickupDate,pickupTime:i.pickupTime,pickupAddress:i.pickupAddress,destinationAddress:i.destinationAddress,passengers:i.passengers,specialNotes:i.specialNotes,airportTrip:i.airportTrip,flightNumber:i.flightNumber,checkingBags:i.checkingBags,roundTrip:i.roundTrip,returnDate:i.returnDate,returnTime:i.returnTime,specialRequirements:i.specialRequirements,otherRequirementText:i.otherRequirementText,isReturnFlight:"No"};if(n.push(o),"Yes"===i.roundTrip){const e={name:i.name,phone:i.phone,email:i.email,pickupDate:i.returnDate,pickupTime:i.returnTime,pickupAddress:i.destinationAddress,destinationAddress:i.pickupAddress,passengers:i.passengers,specialNotes:i.specialNotes,airportTrip:"Yes",flightNumber:i.flightNumber,checkingBags:i.checkingBags,roundTrip:i.roundTrip,returnDate:"",returnTime:"",specialRequirements:i.specialRequirements,otherRequirementText:i.otherRequirementText,isReturnFlight:"Yes"};n.push(e)}const r=n.map(i=>{return n=i,new Promise(function(i,o){var r=new FormData;r.append("entry.131833412",n.name),r.append("entry.776900145",n.phone),r.append("entry.121804187",n.email),r.append("entry.1592582104",n.pickupDate+" "+n.pickupTime),r.append("entry.1137073125",n.pickupAddress),r.append("entry.1747359283",n.destinationAddress),r.append("entry.240227114",n.passengers),r.append("entry.1761921696",n.specialNotes),r.append("entry.1268043435",n.airportTrip),r.append("entry.936388405",n.pickupTime),r.append("entry.1953484756",n.checkingBags),r.append("entry.2847103921",n.roundTrip),r.append("entry.4859203847",n.returnDate+" "+n.returnTime),r.append("entry.3948571029",n.flightNumber||""),r.append("entry.5738291048",""),r.append("entry.6829374816",n.isReturnFlight),n.specialRequirements&&n.specialRequirements.length>0&&n.specialRequirements.forEach(function(e){r.append("entry.1055055925",e)}),n.otherRequirementText&&r.append("entry.1055055925.other_option_response",n.otherRequirementText),e.ajax({url:t,type:"POST",data:r,processData:!1,contentType:!1,cache:!1,complete:function(){i()},error:function(e,t,n){i()}})});var n}),s=(await Promise.allSettled(r)).filter(e=>"rejected"===e.status);if(s.length>0)throw console.error("Some submissions failed:",s),new Error("One or more submissions failed");return n}function f(e){const t=new Date(e),i=e.getHours();let n=new Date(t);if(i>=20)n.setDate(n.getDate()+1),n.setHours(8,0,0,0);else{n=new Date(e.getTime()+108e5);const i=n.getMinutes(),o=5*Math.ceil(i/5);n.setMinutes(o),n.setSeconds(0),n.getHours()>=20&&(n=new Date(t),n.setDate(n.getDate()+1),n.setHours(8,0,0,0))}const o=new Date(e.getTime()+108e5);if(n<o){n=new Date(o);const e=n.getMinutes(),i=5*Math.ceil(e/5);n.setMinutes(i),n.setSeconds(0),n.getHours()>=20&&(n=new Date(t),n.setDate(n.getDate()+1),n.setHours(8,0,0,0))}return n}e(function(){const t=e("#bookingForm");if(0===t.length)return;const i=f(new Date);e("#booking-datetime").flatpickr({enableTime:!0,time_24hr:!1,dateFormat:"m/d/Y H:i:S",altInput:!0,altFormat:"m/d h:i K",minDate:"today",minuteIncrement:5,disableMobile:"never",position:"below",defaultDate:i,onClose:function(t,i,n){if(t.length>0){const i=t[0];c(i.toLocaleDateString("en-US"));const n=i.toISOString().split("T")[0],o=i.toTimeString().slice(0,8);e("#booking-date").val(n),e("#booking-time").val(o)}}});const n=i.toISOString().split("T")[0],s=i.toTimeString().slice(0,8);e("#booking-date").val(n),e("#booking-time").val(s);let v=null;function w(){v&&v.destroy(),v=e("#booking-return-datetime").flatpickr({enableTime:!0,time_24hr:!1,dateFormat:"m/d/Y H:i:S",altInput:!0,altFormat:"m/d h:i K",minDate:"today",minuteIncrement:5,disableMobile:"never",position:"below",onClose:function(t,i,n){if(t.length>0){const n=t[0],o=n.toISOString().split("T")[0],s=n.toTimeString().slice(0,8);e("#booking-return-date").val(o),e("#booking-return-time").val(s),async function(t,i){if(!t)return e("#return-timeline-container").slideUp(),void(i&&i([]));e("#return-timeline-date").text(l(t)),e("#return-timeline-visual").html('<p style="text-align: center; color: #666;">Loading bookings...</p>'),e("#return-timeline-container").slideDown();const n=await r(t);0===n.length?(e("#return-timeline-instruction").hide(),e("#return-timeline-visual").html('<p style="text-align: center; color: #27AE60; font-weight: bold;">All times available!</p>')):(e("#return-timeline-instruction").show(),e("#return-timeline-visual").html(a(n))),i&&i(n)}(o);h(e("#booking-datetime").val(),i)}}})}e("#booking-round-trip").on("change",function(){e(this).is(":checked")&&setTimeout(function(){w()},100)}),o(),e('input[name="airport-trip"]').on("change",function(){g()}),e("#booking-other-requirement").on("change",function(){e(this).is(":checked")?e("#other-requirement-section").slideDown():(e("#other-requirement-section").slideUp(),e("#booking-other-text").val(""))}),e("#booking-round-trip").on("change",function(){g()}),e("#booking-wheelchair, #booking-carseat, #booking-checking-bags").on("change",function(){k()}),e("#booking-passengers").on("input",function(){k()}),e("#booking-datetime").on("change",function(){e("#datetime-error").text("").hide()});let y=[];e("#booking-name").on("input",function(){e(this).val().trim()&&e(this).closest(".form-group").find(".help-block").text("").hide()}),e("#booking-phone").on("input",function(){let t=e(this).val().replace(/\D/g,"");t.length>10&&(t=t.substring(0,10)),e(this).val(t),p(t)&&e(this).closest(".form-group").find(".help-block").text("").hide()}),e("#booking-email").on("input",function(){const t=e(this).val().trim();t&&!u(t)||e(this).closest(".form-group").find(".help-block").text("").hide()}),e('input[name="airport-trip"]').on("change",function(){e(this).closest(".form-group").find(".help-block").text("").hide()}),e("#booking-pickup").on("input",function(){e(this).val().trim()&&(e("#pickup-error").text("").hide(),e(this).closest(".form-group").removeClass("has-error"))}),e("#booking-destination").on("input",function(){e(this).val().trim()&&(e("#destination-error").text("").hide(),e(this).closest(".form-group").removeClass("has-error"))}),e("#booking-name, #booking-phone, #booking-email, #booking-pickup, #booking-destination, #booking-passengers, #booking-notes, #booking-flight, #booking-datetime, #booking-return-datetime").on("focus",function(){e("#booking-success .alert-danger").length>0&&e("#booking-success").html("")}),t.on("submit",async function(i){i.preventDefault(),e(".help-block.text-danger").text("").hide(),e(".has-error").removeClass("has-error"),e("#booking-success").html("").hide();const n=[];let o="";e("#booking-wheelchair").is(":checked")&&n.push("Wheelchair"),e("#booking-carseat").is(":checked")&&n.push("Carseat"),e("#booking-other-requirement").is(":checked")&&(o=e("#booking-other-text").val().trim(),o&&n.push("__other_option__"));const s=e("#booking-date").val(),a=e("#booking-time").val(),g=e("#booking-return-date").val(),k=e("#booking-return-time").val(),v={name:e("#booking-name").val().trim(),phone:e("#booking-phone").val().trim(),email:e("#booking-email").val().trim(),pickupDate:s,pickupAddress:e("#booking-pickup").val().trim(),destinationAddress:e("#booking-destination").val().trim(),passengers:e("#booking-passengers").val().trim(),specialNotes:e("#booking-notes").val().trim(),airportTrip:e('input[name="airport-trip"]:checked').val(),flightNumber:e("#booking-flight").val().trim(),pickupTime:a,checkingBags:e("#booking-checking-bags").is(":checked")?"Yes":"No",roundTrip:e("#booking-round-trip").is(":checked")?"Yes":"No",returnDate:g,returnTime:k,specialRequirements:n,otherRequirementText:o};let w=[],y=!0;v.name||(w.push("Name is required"),e("#booking-name").closest(".form-group").addClass("has-error").find(".help-block").text("Name is required").show(),y=!1),v.phone?p(v.phone)||(w.push("Please enter a valid 10-digit phone number"),e("#booking-phone").closest(".form-group").addClass("has-error").find(".help-block").text("Please enter a valid 10-digit phone number").show(),y=!1):(w.push("Phone number is required"),e("#booking-phone").closest(".form-group").addClass("has-error").find(".help-block").text("Phone number is required").show(),y=!1),v.email&&!u(v.email)&&(w.push("Please enter a valid email address"),e("#booking-email").closest(".form-group").addClass("has-error").find(".help-block").text("Please enter a valid email address").show(),y=!1),v.pickupDate&&v.pickupTime||(w.push("Pickup date and time are required"),e("#booking-datetime").closest(".form-group").addClass("has-error"),e("#datetime-error").text("Pickup date and time are required").show(),y=!1),v.pickupAddress||(w.push("Pickup address is required"),e("#booking-pickup").closest(".form-group").addClass("has-error"),e("#pickup-error").text("Pickup address is required").show(),y=!1),v.destinationAddress||(w.push("Destination address is required"),e("#booking-destination").closest(".form-group").addClass("has-error"),e("#destination-error").text("Destination address is required").show(),y=!1),v.airportTrip||(w.push("Please indicate if this is an airport trip"),e('input[name="airport-trip"]').closest(".form-group").addClass("has-error").find(".help-block").text("Please select an option").show(),y=!1),"Yes"===v.airportTrip&&v.flightNumber&&!/^[a-zA-Z0-9]{2,3}[\s-]?\d{1,4}[a-zA-Z]?$/.test(v.flightNumber)&&(w.push("Please enter a valid flight number (e.g., AA1234)"),e("#booking-flight").closest(".form-group").addClass("has-error").find(".help-block").text("Please enter a valid flight number (e.g., AA1234)").show(),y=!1);const x=m({wheelchair:e("#booking-wheelchair").is(":checked"),carseat:e("#booking-carseat").is(":checked"),checkingBags:e("#booking-checking-bags").is(":checked")});if((parseInt(v.passengers)||1)>x&&(w.push("Maximum "+x+" passengers allowed with selected special requirements"),e("#booking-passengers").closest(".form-group").addClass("has-error"),y=!1),"Yes"===v.roundTrip)if(v.returnDate&&v.returnTime){h(v.pickupDate+" "+v.pickupTime,v.returnDate+" "+v.returnTime)||(w.push("Return date must be after pickup date"),y=!1)}else w.push("Return flight date and time are required for round trips"),e("#booking-return-datetime").closest(".form-group").addClass("has-error"),e("#return-datetime-error").text("Return flight date and time are required").show(),y=!1;if(v.pickupDate&&v.pickupTime){const e=await async function(e,t){return d(e,t,await r(e))}(v.pickupDate,v.pickupTime);e.valid||w.push(e.error)}if(w.length>0){let t='<div class="alert alert-danger"><strong>Please correct the following:</strong><ul style="margin: 10px 0 0 0; padding-left: 20px;">';return w.forEach(function(e){t+="<li>"+e+"</li>"}),t+="</ul></div>",e("#booking-success").html(t).show(),void e("html, body").animate({scrollTop:e("#booking-success").offset().top-100},500)}const T=t.find('button[type="submit"]'),D=T.html();T.html('<i class="fa fa-spinner fa-spin"></i> Submitting...').prop("disabled",!0);try{await b(v);let i='<div class="alert alert-success"><h4><i class="fa fa-check-circle"></i> Booking Request'+("Yes"===v.roundTrip?"s":"")+" Submitted!</h4><p>Thank you, <strong>"+v.name+"</strong>!</p>";i+="Yes"===v.roundTrip?'<p>Your round-trip booking requests have been received:</p><ul style="text-align: left; display: inline-block;"><li><strong>Outbound:</strong> '+l(v.pickupDate)+" at "+v.pickupTime+"</li><li><strong>Return:</strong> "+l(v.returnDate)+" at "+v.returnTime+"</li></ul><p>We will call you at <strong>"+v.phone+"</strong> to confirm both bookings.</p>":"<p>Your booking request for <strong>"+l(v.pickupDate)+"</strong> at <strong>"+v.pickupTime+"</strong> has been received.</p><p>We will call you at <strong>"+v.phone+"</strong> to confirm your booking.</p>",i+="<hr><p><strong>Important:</strong> Your booking"+("Yes"===v.roundTrip?"s are":" is")+" not confirmed until you receive a call from us. If you don't hear from us within 2 hours, please call (980) 422-9125.</p></div>",e("#booking-success").html(i).show(),t.slideUp(),T.html(D).prop("disabled",!1),e("html, body").animate({scrollTop:e("#booking-success").offset().top-100},500),setTimeout(function(){e("#booking-success").append('<p class="text-center" style="margin-top: 20px;"><button id="new-booking-btn" class="btn btn-outline">Make Another Booking</button></p>'),e("#new-booking-btn").on("click",function(){t[0].reset(),e("#booking-success").html("").hide(),e("#timeline-container").hide(),e("#flight-info-section").hide(),e("#checking-bags-section").hide(),e("#round-trip-section").hide(),e("#return-flight-section").hide(),e("#return-timeline-container").hide(),e("#other-requirement-section").hide(),t.slideDown();const i=f(new Date);e("#booking-datetime").flatpickr("setDate",i);const n=i.toISOString().split("T")[0],o=i.toTimeString().slice(0,8);e("#booking-date").val(n),e("#booking-time").val(o),c(n),e("html, body").animate({scrollTop:t.offset().top-100},500)})},2e3)}catch(t){console.error("Submission error:",t);const i='<div class="alert alert-danger"><h4><i class="fa fa-exclamation-triangle"></i> Submission Error</h4><p>There was an error submitting your booking request. Please try again or call us directly at (980) 422-9125.</p><p><strong>Error:</strong> '+t.message+"</p></div>";e("#booking-success").html(i).show(),T.html(D).prop("disabled",!1),e("html, body").animate({scrollTop:e("#booking-success").offset().top-100},500)}});c(i.toISOString().split("T")[0],function(e){y=e}),k()})}(jQuery);